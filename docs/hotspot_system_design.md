"""
çƒ­ç‚¹è¿½è¸ªç³»ç»Ÿ - æ•°æ®æ¨¡å‹ä¸æ¶æ„è®¾è®¡

## 1. æ ¸å¿ƒæ•°æ®æ¨¡å‹

### HotTopic (çƒ­ç‚¹)
- id: çƒ­ç‚¹å”¯ä¸€ID
- title: çƒ­ç‚¹æ ‡é¢˜
- summary: çƒ­ç‚¹æ‘˜è¦
- heat_score: å½“å‰çƒ­åº¦åˆ† (0-100)
- trend: è¶‹åŠ¿ (rising/falling/stable)
- category: åˆ†ç±» (è´¢ç»/ç§‘æŠ€/ç”Ÿæ´»/å¨±ä¹/ç¤¾ä¼š)
- source: æ¥æºå¹³å° (å¾®åš/æŠ–éŸ³/çŸ¥ä¹/ç™¾åº¦)
- source_url: åŸå§‹é“¾æ¥
- keywords: å…³é”®è¯åˆ—è¡¨
- discovered_at: é¦–æ¬¡å‘ç°æ—¶é—´
- updated_at: æœ€åæ›´æ–°æ—¶é—´
- status: çŠ¶æ€ (active/expired/used)

### HotTopicTrend (çƒ­åº¦è¶‹åŠ¿)
- id: è®°å½•ID
- topic_id: å…³è”çƒ­ç‚¹ID
- heat_score: çƒ­åº¦åˆ†
- recorded_at: è®°å½•æ—¶é—´

### HotTopicAlert (çƒ­ç‚¹æ¨é€è®°å½•)
- id: è®°å½•ID
- topic_id: å…³è”çƒ­ç‚¹ID
- alert_type: æ¨é€ç±»å‹ (new/heat_rise/remind)
- sent_at: æ¨é€æ—¶é—´
- feishu_msg_id: é£ä¹¦æ¶ˆæ¯ID
- is_read: æ˜¯å¦å·²è¯»

### HotTopicCategory (çƒ­ç‚¹åˆ†ç±»é…ç½®)
- category: åˆ†ç±»åç§°
- keywords: å…³é”®è¯åˆ—è¡¨
- weight: æƒé‡
- is_enabled: æ˜¯å¦å¯ç”¨

## 2. æŠ“å–ç­–ç•¥

### æ—¶é—´çª—å£
- æŠ“å–æ—¶æ®µ: 07:00 - 23:00
- æŠ“å–é—´éš”: æ¯2å°æ—¶ä¸€æ¬¡
- æ¯æ¬¡æŠ“å–: å…¨å¹³å°è¦†ç›–

### å¹³å°è¦†ç›–
1. å¾®åšçƒ­æœ
2. æŠ–éŸ³çƒ­æ¦œ
3. çŸ¥ä¹çƒ­æ¦œ
4. ç™¾åº¦çƒ­æœ
5. ä»Šæ—¥å¤´æ¡

### é‡‘èé¢†åŸŸä¸“ç”¨æº
1. ä¸œæ–¹è´¢å¯Œçƒ­æ¦œ
2. é›ªçƒçƒ­å¸–
3. è´¢è”ç¤¾å¿«è®¯
4. åå°”è¡—è§é—»

## 3. çƒ­åº¦ç®—æ³•

### çƒ­åº¦è¯„åˆ† (0-100)
```
heat_score = base_score * platform_weight * trend_factor

base_score = min(100, (æœç´¢é‡/10000 + è®¨è®ºé‡/5000 + é˜…è¯»é‡/100000) * 10)
platform_weight = å¾®åš1.2 | æŠ–éŸ³1.0 | çŸ¥ä¹0.9 | ç™¾åº¦0.8
trend_factor = ä¸Šå‡è¶‹åŠ¿1.3 | ç¨³å®š1.0 | ä¸‹é™0.7
```

### è¶‹åŠ¿åˆ¤æ–­
- ä¸Šå‡: 1å°æ—¶å†…çƒ­åº¦å¢é•¿ > 30%
- ç¨³å®š: 1å°æ—¶å†…çƒ­åº¦å˜åŒ– < 30%
- ä¸‹é™: 1å°æ—¶å†…çƒ­åº¦ä¸‹é™ > 30%

## 4. æ¨é€è§„åˆ™

### æ¨é€è§¦å‘æ¡ä»¶
1. **æ–°çƒ­ç‚¹**: é¦–æ¬¡å‘ç°ä¸”çƒ­åº¦ > 60åˆ†
2. **çƒ­åº¦æš´æ¶¨**: 3å°æ—¶å†…çƒ­åº¦å¢é•¿ > 50%
3. **æ¯æ—¥ç²¾é€‰**: æ¯æ™š22:00æ¨é€å½“æ—¥TOP5

### å»é‡è§„åˆ™
- åŸºç¡€å»é‡: 3å¤©å†…ä¸é‡å¤æ¨é€åŒä¸€çƒ­ç‚¹
- ä¾‹å¤–è§„åˆ™: çƒ­åº¦å¢é•¿ > 50% å¯å†æ¬¡æ¨é€
- æ ‡é¢˜ç›¸ä¼¼åº¦: ä½¿ç”¨NLPåˆ¤æ–­ç›¸ä¼¼æ ‡é¢˜ï¼Œç›¸ä¼¼åº¦>80%è§†ä¸ºåŒä¸€çƒ­ç‚¹

### æ¨é€æ¨¡æ¿
```
ğŸ”¥ çƒ­ç‚¹å‘ç° - {{category}}

ã€{{title}}ã€‘
çƒ­åº¦: {{heat_score}}åˆ† ({{trend}})

ğŸ’¡ åˆ›ä½œè§’åº¦:
{{angle}}

ğŸ“Š ç›¸å…³æ•°æ®:
- æœç´¢æŒ‡æ•°: {{search_index}}
- è®¨è®ºé‡: {{discuss_count}}
- é˜…è¯»é‡: {{read_count}}

ğŸ”— æ¥æº: {{source_url}}

â° æ¨é€æ—¶é—´: {{sent_at}}
```

## 5. å®šæ—¶ä»»åŠ¡

### Celery Beat é…ç½®
```python
# æ¯2å°æ—¶æŠ“å–çƒ­ç‚¹
'fetch-hotspots': {
    'task': 'tasks.fetch_hotspots',
    'schedule': crontab(hour='7-23', minute='0', hour_every=2)
}

# æ¯å°æ—¶æ›´æ–°çƒ­åº¦è¶‹åŠ¿
'update-trends': {
    'task': 'tasks.update_trends',
    'schedule': crontab(minute='0')
}

# æ¯æ—¥çƒ­ç‚¹ç²¾é€‰
'daily-hotspot-digest': {
    'task': 'tasks.send_daily_digest',
    'schedule': crontab(hour='22', minute='0')
}
```

## 6. API æ¥å£

### å‰ç«¯æ¥å£
- GET /hotspots - è·å–çƒ­ç‚¹åˆ—è¡¨
- GET /hotspots/:id - è·å–çƒ­ç‚¹è¯¦æƒ…
- GET /hotspots/:id/trend - è·å–çƒ­åº¦è¶‹åŠ¿
- POST /hotspots/:id/adopt - é‡‡çº³çƒ­ç‚¹åˆ›ä½œ

### å†…éƒ¨æ¥å£
- POST /internal/hotspots/fetch - æ‰‹åŠ¨è§¦å‘æŠ“å–
- GET /internal/hotspots/stats - çƒ­ç‚¹ç»Ÿè®¡
- POST /internal/alerts/test - æµ‹è¯•æ¨é€

## 7. ç›‘æ§æŒ‡æ ‡

- æ¯æ—¥æŠ“å–çƒ­ç‚¹æ•°é‡
- çƒ­ç‚¹å¹³å‡çƒ­åº¦
- æ¨é€æˆåŠŸç‡
- ç”¨æˆ·é‡‡çº³ç‡
- çƒ­ç‚¹è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡
